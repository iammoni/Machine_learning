# Stock-Market-Prediction-Machine-learning
Keywords—Machine Learning; stock prediction; Deep     Learning; styling; LSTM(Long Short Term Memory) 

# Goal 
Identifying the best machine learning approach for stock prediction B. Requirement This project requires gathering of stock price dataset of         S&P500Companiesfromyahoofinance.Forthispurpose,the          Pandas python module has been used.The dataset collected is         then stored as a CSV file 
# DATASET AND TOOLS
A.  Gathering Data For this project , S&P 500 list indexhavebeenused.S&P            500 has over 500 companies listed under it. Gather datasetof           all the companies and analysing correlationbetweenthemcan         serve as an important analysis for doing stock prediction.         Other leading index like Dow Jones, has comparably low         number of components which may not be efficient enough in          finding correlation of one company with another. The tool         usedforfindingcorrectionisHeatmap.Again,thecodeforthe           Heatmap was written in Python with the use of Pandas          Correlation function. B. Data Limitations
​ - The dataset gathered from Yahoo        Finance provided opening and closing prices of of eachdaya           particular company traded. The dataset had no information        about the changes in prices of stocks throughout the day.          Sometimes investors depend on the fluctuating prices       throughout the day and bid on stocks depending on the          fluctuations and volatility within a day. C.  Tools- 
​ For this project, python programming language was used. Python provides a list of scientific computational modes likes numpy, pandas, scipy and  matplotlib which are used throughout this project. Python also comes with machines learning packages like sklearn , tensorflow and keras. 
 
# Getting S&P 500 Tickers- 
​ The S&P 500 list is available in wikipedia and a python script was written to crawl the wikipedia page of S&P 500 list and gather all the names of companies listed in it. Dta was gathered using BeautifulSoup module provided by python. All the names of companies were stored in a pickle file. B.    Getting data from Yahoo Finance- 
​ The pickle file was loaded. A for loop was run for every ticker in the pickle file and pandas module was used to get stock data associated with every ticker. For each ticker, a corresponding CSV file was generated and stored in the working directory. Each CSV file contained open, high, low and close columns. 
 

# Applying Machine Learning- 
​ Before applying machine learning, the CSV file containing the closing prices of all the companies needed to be modified. In order to train the machine learning classifier to look into the future , the training 
and testing data should be available in a similar format. Therefore the closing price column had to be shifted back by “n” days and a new column in formed highlighting the shifted price. There are two ways in which machine learning can be applied. 1).    Time Series Prediction with deep learning Keras- Time series analysis is a way of analysing the time series data in order to extract feature-sets of the data.Keras is a high-level neural networks API, written in Python and capable of running on top of either TensorFlow or Theano. It was developed with a focus on enabling fast experimentation. The time series prediction problem can be rephrased as regression problem, that is- given the stock [price of the present day, what will be the stock price of the next day. Initially , the CSV file contained a single column data. But, using simple functions it can be converted into a two column dataset. The first column containing the present day's stock price, and the second column containing the next days stock price which needs to be predicted.This project has working SciPy environment with the Keras deep learning library installed. ● First, modelling of the data is important. Now, the accuracy of the model is checked on the training dataset. Inorder to make the model work for unseen data, training is essential. ● The dataset is splitted in training and testing dataset in 60:40 ratio. However , the ratio can be adjusted so as to observe the accuracy of the model under different ratios. ● The training and testing datasets are numpy arrays. Each array consists of two lists, dataX and dataY. ● dataX can be mapped to dataY by passing the dataset through Multilayer Perceptron Model. ● Various parameters need to be specified likethe number of hidden layers,neurons present in each hidden layer, the output layer and input layer.Stacking of layers can be simply done by the .add() method provided by keras ● configure the learning process using  .compile() method provide by keras. Keras provides an easy way to configure the optimizer. ● The cost function for the model is mean squared error. The training data is iterated in Batches ● Evaluate the performance of the model using .evaluate() method. ● The data is plotted showing the original dataset as blue and the predicted dataset as red  
# Result

 For the above plot,Train Score is  0.05 MSE (0.22 RMSE) and  Test Score is 0.01 MSE (0.11 RMSE).MSEstandsforMean           Square Error and RMSE stands for Root Mean Square Error.          MSE denotes the actual differenceinthetestingandpredicted          datasets
 
 # Second Approach - Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras
 The following steps were performed to do GOOGL stock prediction using LSTM: ● First a window was created whose value depend on how many days we want to look into the future. ● the downloaded CSV file from yahoo finance is loaded with the help of Pandas.  ● Unnecessary columns like date, open , adj. close, adj. open were dropped. Then remaining column left over was “close ” column.  ● The dataset needs to be normalized for the application of LSTM neural network. the normalization is done using MinMaxScaler preprocessing class from the scikit-learn library. ● First, modelling of the data is important. Now, the accuracy of the model is checked on the training dataset. Inorder to make the model work for unseen data, training is essential. ● The dataset is splitted in training and testing dataset in 60:40 ratio. However , the ratio can be adjusted so as to observe the accuracy of the model under different ratios. ● The training and testing datasets are numpy arrays. Each array consists of two lists, dataX and dataY. ● both the training and testing dataset is converted to the format t, t+1, where t tells the value of present day and t+1 tell the value of the next day. ● a look_back parameter has been defined which tells about the number of days to look unto in the future. ● Before training the data , the parameters of the LSTM has been defined. e.g-model.add(LSTM(30, input_shape=(1, look_back))) ● A dense layer can also be added with the LSTM cell e.g- model.add(Dense(1)) ● The model has to be compiled before starting the training-model.compile(loss='mean_squared_error', optimizer='adam') ● Now the trainX and trainY components of the training dataset are fit into the model-model.fit(trainX, trainY, epochs=10, batch_size=1) ● After training the model, the test dataset can be passed for testing the dataset in the trained model ● The difference between the actual value and the predicted value can be calculated by the “mean-square error” method.
 
 # COMPARISON BETWEEN DEEP LEARNING AND LSTM TIME SERIES PREDICTION 
  For the Googl dataset, the train score and test score on Deep Learning  were: Train Score: 504.12 MSE (22.45 RMSE) Test Score: 117.81 MSE (10.85 RMSE) Time taken to produce results: 61.5 sec 
 
 
  For GOOGL(Ticker for Google) dataset the the train score and test score on LSTM  were: Train Score: 24.16 RMSE Test Score: 12.59 RMSE Time taken to produce results: 29.6 sec 
  
#  MY METHODOLOGY TO PREDICT STOCK PRICES 
Since the window discussed in the above LSTM prediction process makes a window containing elements(stock price ) and the number of elements is equal to the size of window. If the window size is  “n”, the it is used to predict values n days into the future. e.g- let's suppose that the value of “n” is 10. This means the window will contain 10 days stock pricing and the window will keep shifting itself by one day. When the window comes to the last 10 dataset and it is passed to LSTM for prediction, then LSTM predicts the value of day 11(1 day into the future).After this the following steps were performed: 1)I have taken that predicted value, and make a new window containing the last 9 datasets and append the value of the predicted price at the end of the window and again the window is passed to LSTM. 2)LSTM now predicts the price of 2 days into the future and step 1 is repeated with window containing the last 8 days value and the appended predicted value. 3)Steps 1 and 2 are repeated until the window comes to the last data present in the dataset. This means is the value of “n” was 10 , then the LSTM program ran for 10 times to predict future 10 days stock price.
